import { Col, Row, Container, Form } from 'react-bootstrap'
import Head from 'next/head'
import styles from '../styles/Auth.module.scss'
import Link from "next/link"
import Layout from '../components/Layout'
import { useDispatch, useSelector } from 'react-redux'
import { useRouter } from 'next/router'
import { login } from '../redux/actions/auth'
import { register } from '../redux/actions/auth'
import { useEffect } from 'react'
import { Alert } from 'react-bootstrap'

const LoginRegister = () => {

  const { auth } = useSelector(state => state)
  const dispatch = useDispatch()
  const router = useRouter()

  useEffect(() => {
    if (auth.token) {
      router.push('/')
    }
  }, [auth.token])

  useEffect(() => {
    if (window.localStorage.getItem('token')) {
      router.push('/')
    }
  }, [])

  const onLogin = async (e) => {
    e.preventDefault()
    const { value: emailLogin } = e.target.elements["emailLogin"];
    const { value: passwordLogin } = e.target.elements["passwordLogin"];
    await dispatch(login(emailLogin, passwordLogin))
  }

  const onRegister = (e) => {
    e.preventDefault()
    const emailRegister = e.target.elements["emailRegister"].value;
    const passwordRegister = e.target.elements["passwordRegister"].value;
    const id_role = e.target.elements["id_role"].value;
    dispatch(register(emailRegister, passwordRegister, id_role))
  }

  return (
    <>
      <Layout>
        <Head>
          <title>The King | Login & Register</title>
          <meta name="description" content="Generated by create next app" />
          <link rel="icon" href="/favicon.ico" />
        </Head>
        <div className={`${styles.profiles} `}>
          <div className="d-flex flex-column justify-content-center">
            <h1 className={`${styles.content} text-center mb-1 mt-5`}>My Account</h1>
            <h5 className={`${styles.content} text-center mb-5`}>Register and log in with your account to be able to shop at will</h5>
          </div>
        </div>
        <Container>
          <Row className='justify-content-center mt-5'>
            <Col xl={6} className='d-flex flex-column'>
              {auth.isErr && <Alert variant="danger" className='text-center'>{auth.errMsg[0]}<br />{auth.errMsg[1]}<br />{auth.errMsg[2]}</Alert>}
              {auth.successMsg && <Alert variant='success' className='text-center'>{auth.successMsg}</Alert>}
            </Col>
          </Row>
          <Row>
            <Col xl={6}>
              <Row className='mt-2 px-5'>
                <Col xl={12} className='mb-5'>
                  <div>
                    <h3>Login</h3>
                  </div>
                </Col>
                <Form onSubmit={onLogin}>
                  <Col xl={12} className='mb-3'>
                    <div>
                      <input type='email' name='emailLogin' className='w-100 px-4 py-3' placeholder='Username or email address'></input>
                    </div>
                  </Col>
                  <Col xl={12} className='mb-4'>
                    <div>
                      <input type='password' name='passwordLogin' className='w-100 px-4 py-3' placeholder='Password'></input>
                    </div>
                  </Col>
                  <Col xl={12} className='mb-5'>
                    <div>
                      <button type='submit' className={`${styles.button} px-5 py-3`}>Login</button>
                    </div>
                  </Col>
                </Form>
                <Col xl={12} >
                  <Row className='mb-5'>
                    <Col xl={4}>
                      <div className="form-check">
                        <input className="form-check-input" type="checkbox" value="" id="flexCheckChecked" />
                        <label className="form-check-label" htmlFor="flexCheckChecked">Remember me</label>
                      </div>
                    </Col>
                    <Col xl={6}>
                      <Link href="/forgot">
                        <a className='text-danger'>Forgot your password</a>
                      </Link>
                    </Col>
                  </Row>
                </Col>
              </Row>
            </Col>
            <Col xl={6}>
              <Row className='mt-2 px-5 mb-5'>
                <Col xl={12} className='mb-5'>
                  <div>
                    <h3>Create Account</h3>
                  </div>
                </Col>
                <Form onSubmit={onRegister}>
                  <Col xl={12} className='mb-3'>
                    <div>
                      <input type='email' name='emailRegister' className='w-100 px-4 py-3' placeholder='Email address'></input>
                    </div>
                  </Col>
                  <Col xl={12} className='mb-4'>
                    <div>
                      <input type='password' name='passwordRegister' className='w-100 px-4 py-3' placeholder='Password'></input>
                    </div>
                  </Col>
                  <Col xl={12} className='mb-4'>
                    <div className='d-flex'>
                      <div className='me-5'>
                        <label className='position-relative align-items-center d-flex'>
                          <input type="radio" className='position-absolute' value='1' name="id_role" />
                          <div className="d-inline-block"></div>
                          <div className="text d-inline-block ms-4">I`m Customer</div>
                        </label>
                      </div>
                      <div className='me-5'>
                        <label className='position-relative align-items-center d-flex'>
                          <input type="radio" className='position-absolute' value='2' name="id_role" />
                          <div className="d-inline-block"></div>
                          <div className="text d-inline-block ms-4">I`m Seller</div>
                        </label>
                      </div>
                    </div>
                  </Col>
                  <Col xl={12}>
                    <div>
                      <button type='submit' className={`${styles.button} px-5 py-3`}>Register</button>
                    </div>
                  </Col>
                </Form>
              </Row>
            </Col>
          </Row>
        </Container >
      </Layout>
    </>
  )
}

export default LoginRegister